((e,t)=>{const adm=e.adm=e.adm||{},n=new URLSearchParams((t.currentScript||[...t.getElementsByTagName("script")].pop()).src.split("?")[1]||"").get("json_id");let o,a;n?(o=`https://ps.l.liftdsp.com/${encodeURIComponent(n)}.json`,a=Array.isArray(window.custom_data)?window.custom_data:[{}]):(o=window.adm&&window.adm.json||void 0,a=Array.isArray(window.admCustomData)?window.admCustomData:[{}]);const i=Object.assign({t:"https://pool.liftdsp.com",o:"https://segment.prod.bidr.io",i:"https://cnv.event.prod.bidr.io",l:"https://track.liftdsp.com/collect"}),r=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),s=(()=>{const e="pixelsink_uid",t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2];const n=r();return document.cookie=`${e}=${n}; path=/; max-age=31536000`,n})();function c(){const e=navigator.userAgent;return/Windows NT/.test(e)?"Windows":/Mac OS X/.test(e)?"macOS":/Linux/.test(e)?"Linux":/Android/.test(e)?"Android":/iPhone|iPad|iPod/.test(e)?"iOS":"Unknown"}function l(e){let t=0;for(let n=0;e.length>n;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return""+t}async function d(){const e=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,Intl.DateTimeFormat().resolvedOptions().timeZone],t=navigator.userAgentData||{},n=function(){const e="mmmyyythisisatest..lliI1!@#",t=["monospace","serif","sans-serif"],n=document,o=n.body||function(){const e=n.createElement("body");return n.documentElement.appendChild(e),e}(),a={};t.forEach(t=>{const i=n.createElement("span");i.style.fontFamily=t,i.style.fontSize="72px",i.style.visibility="hidden",i.style.position="absolute",i.style.left="-9999px",i.innerText=e,o.appendChild(i),a[t]={w:i.offsetWidth,u:i.offsetHeight},o.removeChild(i)});const i=[];for(const r of["Arial","Verdana","Helvetica","Times New Roman","Georgia","Courier New","Courier","Monaco","Trebuchet MS","Impact","Comic Sans MS","Tahoma","Palatino","PT Sans","Apple Color Emoji","Helvetica Neue","Menlo","Brush Script MT","Gill Sans","PingFang SC","Hiragino Kaku Gothic ProN"]){let s=!1;for(const i of t){const t=n.createElement("span");t.style.fontFamily=`'${r}', ${i}`,t.style.fontSize="72px",t.style.visibility="hidden",t.style.position="absolute",t.style.left="-9999px",t.innerText=e,o.appendChild(t);const c=t.offsetWidth,l=t.offsetHeight;if(o.removeChild(t),c!==a[i].w||l!==a[i].u){s=!0;break}}s&&i.push(r)}return i}().join(","),o=(await async function(){try{if(navigator.keyboard&&navigator.keyboard.getLayoutMap){const e=await navigator.keyboard.getLayoutMap(),t=[];for(const n of e.keys())try{t.push(e.get(n))}catch(e){}return[...new Set(t.filter(Boolean))]}}catch(e){}return[]}()).join(","),[a,i]=await Promise.all([new Promise(e=>{setTimeout(()=>{const t=document.createElement("canvas");t.style.display="none",t.width=300,t.height=150,document.body.appendChild(t);const n=t.getContext("2d");n.textBaseline="top",n.font="16px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText("Browser FP Test",2,15),t.toBlob(n=>{const o=new FileReader;o.onloadend=()=>{document.body.removeChild(t),e(l(o.result))},o.readAsBinaryString(n)},"image/png")},300*Math.random()+200)}),new Promise(e=>{try{const t=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,44100,44100),n=t.createOscillator(),o=t.createDynamicsCompressor();n.type="triangle",n.frequency.setValueAtTime(1e4,t.currentTime),o.threshold.setValueAtTime(-50,t.currentTime),o.knee.setValueAtTime(40,t.currentTime),o.ratio.setValueAtTime(12,t.currentTime),o.attack.setValueAtTime(0,t.currentTime),o.release.setValueAtTime(.25,t.currentTime),n.connect(o),o.connect(t.destination),n.start(0),t.startRendering().then(t=>{let n=0;const o=t.getChannelData(0);for(let e=0;o.length>e;e++)n+=Math.abs(o[e]);e(l(""+n))})}catch(t){e("unsupported")}})]),r=function(){const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return{vendor:"unsupported",p:"unsupported"};const n=t.getExtension("WEBGL_debug_renderer_info");return{vendor:n?t.getParameter(n.UNMASKED_VENDOR_WEBGL):"unknown",p:n?t.getParameter(n.UNMASKED_RENDERER_WEBGL):"unknown"}}(),s=[navigator.userAgent.replace(/\/[\d.]+/g,""),navigator.language,screen.width+"x"+screen.height,Intl.DateTimeFormat().resolvedOptions().timeZone,navigator.platform,screen.colorDepth,navigator.hardwareConcurrency,navigator.deviceMemory||0,(navigator.plugins||[]).length,a,i,r.vendor,r.p,(navigator.languages||[]).join(","),window.devicePixelRatio||1,t.brands?t.brands.map(e=>e.brand).join(","):"",t.mobile?"1":"0",c(),"ontouchstart"in window,Array.from(navigator.mimeTypes||[]).map(e=>e.type).join(","),n,o],d=[...e,navigator.platform,screen.colorDepth,navigator.hardwareConcurrency,navigator.deviceMemory||0,(navigator.plugins||[]).length,a,i,r.vendor,r.p];return{fingerprint_ortb:btoa(s.join("|")),fingerprint_highres:btoa(d.join("|"))}}const u=(e,t={},n="query")=>{const o=[];for(const n in t)if(!e||!e.custom_data||e.custom_data.includes(n)){const e=Array.isArray(t[n])?t[n].join("+"):t[n];o.push(`${encodeURIComponent(n)}=${encodeURIComponent(e)}`)}return o.join("inline"===n?";":"&")},p=e=>{(new Image).src=e},_=async({_:e,custom_data:t,timestamp:n,pixel_fire_id:o,pixel_fire_group_id:a})=>{const[r,l]=await Promise.all([d(),new Promise(e=>function(e){const t={tcf_string:null,gdpr_applies:null,us_privacy_string:null};let n=0;"function"==typeof __tcfapi&&(n++,__tcfapi("getTCData",2,(o,a)=>{a&&o&&(t.tcf_string=o.m||null,t.gdpr_applies=o.v??null),0===--n&&e(t)})),"function"==typeof __uspapi&&(n++,__uspapi("getUSPData",1,(o,a)=>{a&&o&&(t.us_privacy_string=o.$||null),0===--n&&e(t)})),0===n&&e(t),setTimeout(()=>{n>0&&e(t)},500)}(e))]),u={i_segment_id:e?.id,b_segment_id:e.bid,b_event_id:e.eid,lift_user_id:s,pixel_fire_id:o,pixel_fire_group_id:a,custom_data:t||t[0],trigger_rule:e.rules||null,fingerprint_ortb:r.fingerprint_ortb,fingerprint_highres:r.fingerprint_highres,url:location.href,device:{user_agent:navigator.userAgent,language:navigator.language,platform:navigator.userAgentData?.platform||navigator.platform,screen:`${screen.width}x${screen.height}`,device_type:/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop",os:c()},tcf_string:l.tcf_string,gdpr_applies:l.gdpr_applies,us_privacy_string:l.us_privacy_string,timestamp:n||(new Date).toISOString()},_=btoa(JSON.stringify(u));p(`${i.l}?data=${_}`)},g=(e,n,o,a)=>{e.length&&(e=>{if([...t.getElementsByTagName("script")].some(t=>t.src===e))return;const n=t.createElement("script");n.src=e,n.async=!0,t.head.appendChild(n)})(`${i.t}/pixel?id=${e.join(",")}&t=js&sink_id=${s}&${n}&timestamp=${o}&fire_id=${a}`)},m=(e,t,n)=>{e.forEach(e=>{e&&p(`${i.o}/associate-segment?account_id=2&buzz_key=moot&value=${n}&segment_key=moot-${e}&ord=${t}`)})},f=(e,t,n,o)=>{const a=u(null,t,"inline");Object.entries(e).forEach(([e,t])=>{t&&p(`${i.i}/log/cnv?tag_id=${t}&buzz_key=moot&value=${o}&account_id=2&order=${a}&ord=${n}&segment_key=moot-${e}`)})},w=async e=>{const t=[],n=[],o={},i=a[0]||{},s=u(null,i),c=(new Date).toISOString(),l=`${Date.now()}-${r()}`;if(e&&e.length)for(const a of e){const e=`${Date.now()}-${r()}`;t.push(a.id),n.push(a.bid),a.eid&&(o[a.bid]=a.eid),await _({_:a,custom_data:i,timestamp:c,pixel_fire_id:e,pixel_fire_group_id:l}),g([a.id],s,c,e),m([a.bid],c,e),f({[a.bid]:a.eid},i,c,e)}},v=()=>{o&&fetch(o).then(e=>e.json()).then(t=>{const n=location.href,o=[];t.pixels.forEach(t=>{((t,n,o=1)=>!(!t.rules||!Array.isArray(t.rules))&&t.rules.every(a=>{const i=a.values;let r=!1,s="";switch(a.type){case"url_contains":r=i.some(e=>n.includes(e)),s=r?"match":"no match";break;case"url_does_not_contain":r=i.every(e=>!n.includes(e)),s=r?"clean":"blocked";break;case"url_match":r=i.some(e=>RegExp(`^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}$`,"i").test(n)),s=r?"regex match":"no match";break;case"url_does_not_match":r=i.every(e=>!RegExp(`^${e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}$`,"i").test(n)),s=r?"clean":"regex blocked";break;case"frequency":if(i?.operator&&void 0!==i.value){const e={h:e=>e>i.value,k:e=>i.value>e,S:e=>e===i.value};r=e[i.operator]?.(o),s=`${i.operator} ${i.value}`}break;case"anniversary":r=(new Date).getMonth()===parseInt(i),s="month="+(new Date).getMonth();break;case"custom_data":const a=((e.adm=e.adm||{}).custom_data?.[0]||{})[i.key];if(void 0!==a){const e=i.operator,t=i.value;r={S:(e,t)=>e==t,h:(e,t)=>parseFloat(e)>parseFloat(t),k:(e,t)=>parseFloat(t)>parseFloat(e),P:(e,t)=>e!=t,contains:(e,t)=>(e+"").includes(t)}[e]?.(a,t)??!1,s=r?"custom match":"custom fail"}else s="custom key missing";break;case"recency":const c=`liftpx_${t.id}_ts`,l=localStorage.getItem(c),d=Date.now(),u=864e5*parseInt(i.A);l?(r=d-parseInt(l)>=u,s=r?"recency ok":"too soon",r&&localStorage.setItem(c,""+d)):(localStorage.setItem(c,""+d),r=!0,s="first fire");break;case"time_spent":return setTimeout(()=>{w([t])},1e3*(parseInt(i)||10)),!1;default:s="unsupported"}return r}))(t,n)&&o.push(t)}),t.id&&!o.some(e=>e.id===t.id)&&o.push({id:t.id,bid:t.bid}),w(o)}).then(e=>{}).catch(e=>{})};"complete"===t.readyState||"interactive"===t.readyState?v():t.addEventListener("DOMContentLoaded",v),adm.track=({id:e,bid:t,eid:n})=>w([{id:e,bid:t,eid:n}])})(window,document);
//# sourceMappingURL=smartpixel.min.js.map